<!DOCTYPE html>
<html lang="fa">
<head>
    <meta charset="UTF-8">
    <title>Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <style>
        .search-box {
            margin-bottom: 20px;
            text-align: right;
        }
        .search-box input {
            width: 300px;
            padding: 8px;
            font-size: 14px;
        }
        .pagination {
            margin-top: 20px;
            text-align: center;
        }
        .pagination button {
            padding: 6px 12px;
            margin: 0 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>

<div class="page">
    <h1>ğŸ‘¥ Ù„ÛŒØ³Øª Ø§Ø¹Ø¶Ø§</h1>

    <div class="search-box">
        <label for="memberSearch">ğŸ” Ø¬Ø³Øªâ€ŒÙˆØ¬Ùˆ: </label>
        <input type="text" id="memberSearch" placeholder="Ù†Ø§Ù… ÛŒØ§ Ú©Ø¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯...">
    </div>

    <table class="data-table" id="membersTable">
        <thead>
            <tr>
                <th>Ø¹Ú©Ø³</th>
                <th>Ù†Ø§Ù…</th>
                <th>Ú©Ø¯</th>
                <th>Ù¾Ø§ÛŒÙ‡</th>
                <th>Ø´Ù…Ø§Ø±Ù‡ ØªÙ…Ø§Ø³</th>
                <th>Ø¹Ù…Ù„ÛŒØ§Øª</th>
            </tr>
        </thead>
        <tbody>
            {% for member in members %}
            <tr>
                <td>
                    {% if member.photo_path %}
                        <img src="{{ url_for('static', filename='photos/' ~ member.photo_path) }}" width="50">
                    {% else %}
                        âŒ
                    {% endif %}
                </td>
                <td>{{ member.name }}</td>
                <td>{{ member.code }}</td>
                <td>{{ member.grade }}</td>
                <td>{{ member.phone }}</td>
                <td>
                    <a href="/member/{{ member.id }}" class="btn info">Ø§Ø·Ù„Ø§Ø¹Ø§Øª</a>
                    <a href="/edit_member/{{ member.id }}" class="btn edit">ÙˆÛŒØ±Ø§ÛŒØ´</a>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="pagination">
        <button id="prevPage">â¬… Ù‚Ø¨Ù„ÛŒ</button>
        <span id="pageInfo"></span>
        <button id="nextPage">Ø¨Ø¹Ø¯ÛŒ â¡</button>
    </div>
</div>

<script>
    const rowsPerPage = 10;
    let currentPage = 1;

    const searchInput = document.getElementById("memberSearch");
    const table = document.getElementById("membersTable");
    const rows = Array.from(table.querySelectorAll("tbody tr"));

    function getFilteredRows() {
        const filter = searchInput.value.toLowerCase();
        return rows.filter(row => {
            const name = row.cells[1].textContent.toLowerCase();
            const code = row.cells[2].textContent.toLowerCase();
            return name.includes(filter) || code.includes(filter);
        });
    }

    function renderTable() {
        const filteredRows = getFilteredRows();
        const totalPages = Math.ceil(filteredRows.length / rowsPerPage) || 1;

        if (currentPage > totalPages) currentPage = totalPages;

        rows.forEach(row => row.style.display = "none");

        const start = (currentPage - 1) * rowsPerPage;
        const end = start + rowsPerPage;

        filteredRows.slice(start, end).forEach(row => {
            row.style.display = "";
        });

        document.getElementById("pageInfo").textContent =
            `ØµÙØ­Ù‡ ${currentPage} Ø§Ø² ${totalPages}`;
    }

    document.getElementById("prevPage").onclick = () => {
        if (currentPage > 1) {
            currentPage--;
            renderTable();
        }
    };

    document.getElementById("nextPage").onclick = () => {
        currentPage++;
        renderTable();
    };

    searchInput.addEventListener("keyup", () => {
        currentPage = 1;
        renderTable();
    });

    renderTable();
</script>

</body>
</html>
